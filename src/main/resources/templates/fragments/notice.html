<header th:fragment="notice">
    <div sec:authorize="isAuthenticated()" class="notice">
        <div class="notice-container">

            <!-- Modal 열기 버튼 -->
            <button class="modalOpen" th:attr="data-uid=${user.uid}">
                <img class="bell" src="/image/main/notice.png" alt="이미지 설명" style="width: 60px; height: 60px;">
            </button>

            <!-- 모달 -->
            <div class="modal" style="display: none;">
                <div class="modal_body">
                    <h1>알림 목록</h1>
                    <ul id="noticeList">
                        <!-- AJAX로 데이터를 가져와 여기에 동적으로 추가 -->
                    </ul>
                </div>
            </div>
            <script>
                const modal = document.querySelector('.modal');
                const modalBody = document.querySelector('.modal_body');
                const btnOpenModal = document.querySelector('.modalOpen');
                const noticeList = document.getElementById('noticeList');
                const userUid = btnOpenModal.dataset.uid;

                // 모달 열기 버튼 클릭 시 모달 창 보이기 및 AJAX 요청
btnOpenModal.addEventListener("click", () => {
    modal.style.display = "flex";

    // AJAX로 서버에서 알림 데이터를 가져오기
    fetch(`/notices?uid=${userUid}`)
        .then(response => {
            if (!response.ok) {
                throw new Error('HTTP error! Status: ' + response.status);
            }
            return response.json(); // 서버에서 JSON 데이터를 파싱
        })
        .then(data => {
            console.log("Fetched data:", data); // 데이터를 콘솔에 출력하여 확인

            // 알림 리스트 초기화
            noticeList.innerHTML = '';  // 기존 항목 제거

            // 가져온 알림 데이터를 리스트에 추가
            data.forEach(message => {
                const li = document.createElement('li'); // <li> 태그 생성
                li.textContent = message;  // 메시지 추가
                noticeList.appendChild(li);  // <ul>에 <li> 추가
            });
        })
        .catch(error => {
            console.error('Error fetching notices:', error);
        });
});


// 모달 열기 버튼 클릭 시 모달 열기
btnOpenModal.addEventListener("click", () => {
    modal.classList.add('modalOpen');  // modalOpen 클래스로 애니메이션 시작
});

// 모달 외부 클릭 시 모달 닫기
modal.addEventListener("click", (event) => {
    if (!modalBody.contains(event.target)) {  // 모달 외부를 클릭했을 때
        modal.classList.remove('modalOpen');  // modalOpen 클래스 제거로 애니메이션 종료
    }
});

            </script>
        </div>
    </div>
</header>
